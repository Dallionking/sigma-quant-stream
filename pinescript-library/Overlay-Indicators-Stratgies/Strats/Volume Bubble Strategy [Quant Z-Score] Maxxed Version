// This Pine Script¬Æ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// ¬© Maximilianned

// Special thanks to L&L Capital for the inspiration behind the LNL Trend System ‚Äî an excellent foundation for dynamic trailing and chop filtering.
// Additional thanks to tncylyv for the original hilarious and highly effective volume delta bubble concept that started it all. 
// jdehorty for the Nadaraya Watson Regression Kernal 
// This version refined and combined by Max.


//@version=6
strategy("Delta/Volume Bubble Strategy [Quant Z-Score] by Maximilianned", overlay=true, max_labels_count=500, pyramiding=1, default_qty_type=strategy.fixed, default_qty_value=1)

import TradingView/ta/11 as wizardry

var string boring_stuff     = "Data Settings"
var string brain_power     = "Quant Logic"
var string sponge_zone     = "Absorption Logic (Effort vs Result)"
var string fancy_pants     = "Visuals"
var string air_raid        = "Alert Configuration"
var string strategy_stuff  = "Strategy Settings"
var string lnl_group       = "LNL Trend Filter & Trailing"
var string secret_msg      = "Check the boxes below to enable internal alerts. When creating the Alert in TradingView, select 'Any alert() function call'."

potato_battery_source = input.string("Volume Delta", "Calculation Source", options=["Volume Delta", "Regular Volume"], group=boring_stuff)
tiny_time_wimey = input.timeframe("1S", "Lower TF Granularity", group=boring_stuff)
heavy_anchor = input.timeframe("", "Anchor TF (empty = current)", group=boring_stuff)
time_machine = input.int(60, "Statistical Lookback", minval=20, group=boring_stuff)

math_mode = input.string("Adaptive (Z-Score)", "Calculation Mode", options=["Adaptive (Z-Score)", "Fixed (Absolute Value)"], group=brain_power)
danger_zone = input.float(1.7, "Bubble Z-Score Threshold (œÉ)", minval=0.5, step=0.1, group=brain_power, tooltip="Threshold for showing bubbles (visual only)")
entry_z_threshold = input.float(1.7, "Entry Z-Score Threshold (œÉ)", minval=0.5, step=0.1, group=brain_power, tooltip="Higher = fewer, higher-quality signals")

minimum_wage = input.float(200.0, "Fixed Mode: Min Volume", minval=1.0, group=brain_power)

sponge_bob = input.bool(false, "Detect Absorption", group=sponge_zone)
squeeze_factor = input.float(0.6, "Absorption Ratio", minval=0.1, maxval=1.0, step=0.1, group=sponge_zone)

happy_green = input.bool(true, "Show Bullish", inline="disp", group=fancy_pants)
sad_red = input.bool(true, "Show Bearish", inline="disp", group=fancy_pants)
balloon_animal = input.bool(true, "Scale Size by Z-Score", inline="scale", group=fancy_pants)
chameleon_skin = input.bool(true, "Adaptive Color Intensity", inline="scale", group=fancy_pants)

ghost_mode = input.int(85, "Fixed Opacity (1-100)", minval=1, maxval=100, group=fancy_pants, active=not chameleon_skin)
radioactive = input.bool(true, "Glow Effect", inline="glow", group=fancy_pants)
comic_sans_wannabe = input.string("Default", "Font", options=["Default", "Monospace"], inline="font", group=fancy_pants)
fashion_show = input.string("Dark Theme (Mint‚ÄìCoral)", "Theme", options=["Dark Theme (Mint‚ÄìCoral)", "Light Theme (Royal‚ÄìSunset)"], group=fancy_pants)

siren_woop_woop = input.bool(false, "Alert: Unusual Threshold Trigger", group=air_raid)
sponge_alarm = input.bool(false, "Alert: Absorption Detected", group=air_raid)

// === Strategy Settings ===
enable_trading          = input.bool(false, "Enable Strategy Mode", group=strategy_stuff)
enable_trend_filter     = input.bool(true, "Enable Trend Filter", group=strategy_stuff)
trend_type              = input.string("Nadaraya-Watson RQ", "Trend Filter Type", options=["None", "EMA", "WMA", "KAMA", "Nadaraya-Watson RQ"], group=strategy_stuff)
trend_length            = input.int(200, "Trend Length / Window Size", minval=1, group=strategy_stuff)

// Trend Line Appearance
trend_line_color        = input.color(color.white, "Trend Line Color", group=strategy_stuff)
trend_line_transp       = input.int(0, "Trend Line Transparency (0-100)", minval=0, maxval=100, group=strategy_stuff)
trend_line_width        = input.int(2, "Trend Line Width", minval=1, maxval=4, group=strategy_stuff)

// Conditional NW inputs
nw_rel_weight           = input.float(6.0, "NW Relative Weighting", step=0.1, group=strategy_stuff, tooltip="Higher = smoother / less reactive", active = trend_type == "Nadaraya-Watson RQ")
nw_start_bar            = input.int(0, "NW Start Regression at Bar Index", minval=0, group=strategy_stuff, active = trend_type == "Nadaraya-Watson RQ")

// Conditional KAMA inputs
kama_fast               = input.int(2, "KAMA Fast Length", minval=1, group=strategy_stuff, active = trend_type == "KAMA")
kama_slow               = input.int(30, "KAMA Slow Length", minval=1, group=strategy_stuff, active = trend_type == "KAMA")

atr_stop_mult           = input.float(1.5, "ATR Stop Multiplier (legacy)", minval=0.1, step=0.1, group=strategy_stuff)
rr_ratio                = input.float(2.0, "Risk:Reward Ratio (legacy)", minval=1.0, step=0.1, group=strategy_stuff)
position_size           = input.int(1, "Position Size (contracts/shares)", minval=1, group=strategy_stuff)

// === LNL Trend Filter ===
enable_lnl              = input.bool(true, "Enable LNL Chop Filter & Visuals", group=lnl_group, tooltip="Disables signals when dots appear on both sides (sideways/no-go zone)")
lnl_mode                = input.string("Normal", "LNL Trend Mode", options=["Tight", "Normal", "Loose", "FOMC", "Net"], group=lnl_group)
show_lnl_trend          = input.bool(true, "Show LNL Trend Line (13 EMA)", group=lnl_group)
show_lnl_stops          = input.bool(true, "Show LNL Stop Dots", group=lnl_group)
show_lnl_cloud          = input.bool(true, "Show LNL Cloud", group=lnl_group)

lnl_trend_bull          = input.color(#27c22e, "LNL Trend Bullish", group=lnl_group)
lnl_trend_bear          = input.color(#ff0000, "LNL Trend Bearish", group=lnl_group)
lnl_trend_neutral       = input.color(#434651, "LNL Trend Neutral", group=lnl_group)
lnl_stop_bull           = input.color(#27c22e, "LNL Stop Bullish", group=lnl_group)
lnl_stop_bear           = input.color(#ff0000, "LNL Stop Bearish", group=lnl_group)
lnl_cloud_bull          = input.color(color.rgb(39,194,46,85), "LNL Cloud Bullish", group=lnl_group)
lnl_cloud_bear          = input.color(color.rgb(255,0,0,85), "LNL Cloud Bearish", group=lnl_group)

// Custom KAMA Function
custom_kama(src, period, fast_len, slow_len) =>
    float mom = math.abs(src - src[period])
    float vol = math.sum(math.abs(src - src[1]), period)
    float er = vol != 0 ? mom / vol : 0
    float fast_sc = 2.0 / (fast_len + 1.0)
    float slow_sc = 2.0 / (slow_len + 1.0)
    float sc = math.pow(er * (fast_sc - slow_sc) + slow_sc, 2)
    var float kama_val = na
    kama_val := na(kama_val[1]) ? src : kama_val[1] + sc * (src - kama_val[1])
    kama_val

type UnicornVomit
    color happy_juice
    color angry_juice
    color happy_glow
    color angry_glow
    color sponge_glow 
    color ink_color

var todays_outfit = switch fashion_show
    "Dark Theme (Mint‚ÄìCoral)" => UnicornVomit.new(color.new(#009664, 0), color.new(#b6003d, 0), color.new(#00d19d, 85), color.new(#ff3679, 85), color.new(#9d00ff, 30), color.white)
    => UnicornVomit.new(color.new(color.rgb(0, 102, 255), 0), color.new(color.rgb(255, 128, 0), 0), color.new(color.rgb(102, 178, 255), 85), color.new(color.rgb(255, 179, 102), 85), color.new(#6a00ff, 40), color.rgb(0, 0, 0))

string the_chosen_one = ticker.standard(syminfo.tickerid)

[pizza_start, pizza_max, pizza_min, pizza_end] = request.security(the_chosen_one, timeframe.period, wizardry.requestVolumeDelta(tiny_time_wimey, heavy_anchor))
float plain_water = request.security(the_chosen_one, timeframe.period, volume)
[real_deal_o, real_deal_h, real_deal_l, real_deal_c] = request.security(the_chosen_one, timeframe.period, [open, high, low, close])
float wiggle_room = request.security(the_chosen_one, timeframe.period, ta.atr(14))
[tiny_candles, tiny_noises] = request.security_lower_tf(the_chosen_one, tiny_time_wimey, [close, volume])

float raw_fish = potato_battery_source == "Volume Delta" ? pizza_end - pizza_start : (real_deal_c >= real_deal_o ? plain_water : -plain_water)
float absolute_vodka = math.abs(raw_fish)

float boring_average = ta.sma(absolute_vodka, time_machine)
float deviant_behavior = ta.stdev(absolute_vodka, time_machine)
float alien_math = deviant_behavior != 0 ? (absolute_vodka - boring_average) / deviant_behavior : 0.0

bool bubble_kaboom = math_mode == "Adaptive (Z-Score)" ? alien_math >= danger_zone : absolute_vodka >= minimum_wage
bool entry_kaboom  = math_mode == "Adaptive (Z-Score)" ? alien_math >= entry_z_threshold : absolute_vodka >= minimum_wage

float thiccness = math.abs(real_deal_c - real_deal_o)
float avg_thiccness = ta.sma(thiccness, time_machine)
bool is_spongy = sponge_bob and bubble_kaboom and (thiccness < avg_thiccness * squeeze_factor)

// === Main Trend Filter (NW/EMA/etc) ===
float trend_line = na
if trend_type == "EMA"
    trend_line := ta.ema(real_deal_c, trend_length)
else if trend_type == "WMA"
    trend_line := ta.wma(real_deal_c, trend_length)
else if trend_type == "KAMA"
    trend_line := custom_kama(real_deal_c, trend_length, kama_fast, kama_slow)
else if trend_type == "Nadaraya-Watson RQ"
    int h = trend_length
    float r = nw_rel_weight
    int start_i = nw_start_bar
    float sum = 0.0
    float sumw = 0.0
    for i = start_i to h - 1
        if bar_index - i >= 0
            float weight = math.pow(1 + (math.pow(i, 2) / (r * r * h * h)), -r)
            sum += real_deal_c[i] * weight
            sumw += weight
    trend_line := sumw != 0 ? sum / sumw : na

plot(trend_line, "Trend Filter Line", color=color.new(trend_line_color, trend_line_transp), linewidth=trend_line_width)

// === LNL Trend System ===
float lnl_trend = ta.ema(real_deal_c, 13)
float ema8 = ta.vwma(real_deal_c, 8)
float ema13 = ta.vwma(real_deal_c, 13)
float ema21 = ta.vwma(real_deal_c, 21)
float ema34 = ta.vwma(real_deal_c, 34)
bool emaup = ema8 > ema13 and ema13 > ema21 and ema21 > ema34
bool emadn = ema8 < ema13 and ema13 < ema21 and ema21 < ema34

color lnl_trend_color = emadn and real_deal_c <= lnl_trend ? lnl_trend_bear : emaup and real_deal_c >= lnl_trend ? lnl_trend_bull : lnl_trend_neutral

plot(show_lnl_trend ? lnl_trend : na, "LNL Trend (13 EMA)", color=show_lnl_trend ? lnl_trend_color : na, linewidth=2)

// ATR & Stops
int ATRLength = lnl_mode == "Tight" ? 60 : lnl_mode == "Normal" ? 80 : lnl_mode == "Loose" ? 100 : lnl_mode == "FOMC" ? 120 : 140
float smoothed_atr = ta.ema(ta.tr(true), 8)

// Primary
float ATR = (ATRLength / 100.0) * smoothed_atr
bool Up = real_deal_c > (lnl_trend + ATR)
bool Down = real_deal_c < (lnl_trend - ATR)
var int T = 0
T := Up ? 1 : Down ? -1 : T[1]
float primary_stop_y = T == 1 ? lnl_trend - ATR : T == -1 ? lnl_trend + ATR : na

// Secondary
float ATRA = (ATRLength - 20) / 100.0 * smoothed_atr
bool UpA = real_deal_c > (lnl_trend + ATRA)
bool DownA = real_deal_c < (lnl_trend - ATRA)
var int TA = 0
TA := UpA ? 1 : DownA ? -1 : TA[1]
float stopA_y = TA == 1 ? lnl_trend - ATRA : TA == -1 ? lnl_trend + ATRA : na

// Net extras - declared globally
var int TNET = 0
var int TNET1 = 0
var int TNET2 = 0
float stopNET_y = na
float stopNET1_y = na
float stopNET2_y = na

if lnl_mode == "Net"
    float ATRNET = (ATRLength - 40) / 100.0 * smoothed_atr
    bool UpNET = real_deal_c > (lnl_trend + ATRNET)
    bool DownNET = real_deal_c < (lnl_trend - ATRNET)
    TNET := UpNET ? 1 : DownNET ? -1 : TNET[1]
    stopNET_y := TNET == 1 ? lnl_trend - ATRNET : TNET == -1 ? lnl_trend + ATRNET : na
    
    float ATRNET1 = (ATRLength - 60) / 100.0 * smoothed_atr
    bool UpNET1 = real_deal_c > (lnl_trend + ATRNET1)
    bool DownNET1 = real_deal_c < (lnl_trend - ATRNET1)
    TNET1 := UpNET1 ? 1 : DownNET1 ? -1 : TNET1[1]
    stopNET1_y := TNET1 == 1 ? lnl_trend - ATRNET1 : TNET1 == -1 ? lnl_trend + ATRNET1 : na
    
    float ATRNET2 = (ATRLength - 80) / 100.0 * smoothed_atr
    bool UpNET2 = real_deal_c > (lnl_trend + ATRNET2)
    bool DownNET2 = real_deal_c < (lnl_trend - ATRNET2)
    TNET2 := UpNET2 ? 1 : DownNET2 ? -1 : TNET2[1]
    stopNET2_y := TNET2 == 1 ? lnl_trend - ATRNET2 : TNET2 == -1 ? lnl_trend + ATRNET2 : na

// Plot stops with per-level colors
plotchar(show_lnl_stops ? primary_stop_y : na, "LNL Primary Stop", char="-", location=location.absolute, size=size.tiny, color=T == 1 ? lnl_stop_bull : lnl_stop_bear)
plotchar(show_lnl_stops ? stopA_y : na, "LNL Stop A", char="-", location=location.absolute, size=size.tiny, color=TA == 1 ? lnl_stop_bull : lnl_stop_bear)
plotchar(show_lnl_stops and lnl_mode == "Net" ? stopNET_y : na, "LNL Stop NET", char="-", location=location.absolute, size=size.tiny, color=TNET == 1 ? lnl_stop_bull : lnl_stop_bear)
plotchar(show_lnl_stops and lnl_mode == "Net" ? stopNET1_y : na, "LNL Stop NET1", char="-", location=location.absolute, size=size.tiny, color=TNET1 == 1 ? lnl_stop_bull : lnl_stop_bear)
plotchar(show_lnl_stops and lnl_mode == "Net" ? stopNET2_y : na, "LNL Stop NET2", char="-", location=location.absolute, size=size.tiny, color=TNET2 == 1 ? lnl_stop_bull : lnl_stop_bear)

// Chop detection
bool has_lower_stop = false
bool has_upper_stop = false
if not na(primary_stop_y)
    has_lower_stop := primary_stop_y < real_deal_c ? true : has_lower_stop
    has_upper_stop := primary_stop_y > real_deal_c ? true : has_upper_stop
if not na(stopA_y)
    has_lower_stop := stopA_y < real_deal_c ? true : has_lower_stop
    has_upper_stop := stopA_y > real_deal_c ? true : has_upper_stop
if lnl_mode == "Net"
    if not na(stopNET_y)
        has_lower_stop := stopNET_y < real_deal_c ? true : has_lower_stop
        has_upper_stop := stopNET_y > real_deal_c ? true : has_upper_stop
    if not na(stopNET1_y)
        has_lower_stop := stopNET1_y < real_deal_c ? true : has_lower_stop
        has_upper_stop := stopNET1_y > real_deal_c ? true : has_upper_stop
    if not na(stopNET2_y)
        has_lower_stop := stopNET2_y < real_deal_c ? true : has_lower_stop
        has_upper_stop := stopNET2_y > real_deal_c ? true : has_upper_stop

bool is_chop = has_lower_stop and has_upper_stop

// Cloud
p_lnl_trend = plot(show_lnl_cloud ? lnl_trend : na, display=display.none)
p_lnl_primary = plot(show_lnl_cloud ? primary_stop_y : na, display=display.none)
fill(p_lnl_trend, p_lnl_primary, color = show_lnl_cloud ? (T == 1 ? lnl_cloud_bull : lnl_cloud_bear) : na)

// === Signal Conditions ===
bool trend_ok_long  = not enable_trend_filter or (trend_type == "None") or (real_deal_c > trend_line)
bool trend_ok_short = not enable_trend_filter or (trend_type == "None") or (real_deal_c < trend_line)

bool long_momentum  = entry_kaboom and (raw_fish > 0) and trend_ok_long and not is_spongy and (not enable_lnl or not is_chop)
bool short_momentum = entry_kaboom and (raw_fish < 0) and trend_ok_short and not is_spongy and (not enable_lnl or not is_chop)

// Tiny subtle arrows
plotshape(long_momentum,  title="Long Signal",  location=location.belowbar, color=color.new(color.lime, 0), style=shape.triangleup,   size=size.tiny)
plotshape(short_momentum, title="Short Signal", location=location.abovebar, color=color.new(color.red, 0),  style=shape.triangledown, size=size.tiny)

// === Bubble Visualization ===
float magic_carpet = na
if bubble_kaboom
    float pricey_vol = 0.0
    float summy_vol = 0.0
    int ant_colony_size = array.size(tiny_candles)
    if ant_colony_size > 0
        for i = 0 to ant_colony_size - 1
            float noise = array.get(tiny_noises, i)
            float price_tag = array.get(tiny_candles, i)
            if not na(noise) and not na(price_tag)
                pricey_vol += price_tag * noise
                summy_vol += noise
    float truth_serum = summy_vol > 0 ? pricey_vol / summy_vol : na
    magic_carpet := na(truth_serum) ? (real_deal_o + real_deal_h + real_deal_l + real_deal_c) / 4.0 : truth_serum

make_pretty_numbers(float junk) =>
    float tidy_junk = math.abs(junk)
    tidy_junk >= 1e9 ? str.tostring(tidy_junk / 1e9, format.volume) + "B" : tidy_junk >= 1e6 ? str.tostring(tidy_junk / 1e6, format.volume) + "M" : tidy_junk >= 1e3 ? str.tostring(tidy_junk / 1e3, format.volume) + "K" : str.tostring(tidy_junk, format.volume)

if bubble_kaboom
    bool stonks_only_go_up = raw_fish > 0
    if (stonks_only_go_up and happy_green) or (not stonks_only_go_up and sad_red)
        float invinsibility_cloak = 100.0 - ghost_mode
        float spiciness = chameleon_skin ? math.max(0, 100 - (alien_math * 20)) : invinsibility_cloak
        color jelly_bean = stonks_only_go_up ? color.new(todays_outfit.happy_juice, spiciness) : color.new(todays_outfit.angry_juice, spiciness)
        color radioactive_sludge = is_spongy ? todays_outfit.sponge_glow : (stonks_only_go_up ? todays_outfit.happy_glow : todays_outfit.angry_glow)
        color nuclear_waste = chameleon_skin ? radioactive_sludge : color.new(radioactive_sludge, invinsibility_cloak)
        color scribbles = chameleon_skin ? todays_outfit.ink_color : todays_outfit.ink_color

        string pants_size = "S"
        if math_mode == "Adaptive (Z-Score)" and balloon_animal
            pants_size := alien_math > danger_zone + 2.0 ? "L" : alien_math > danger_zone + 1.0 ? "M" : "S"
        else if balloon_animal
            pants_size := absolute_vodka > (minimum_wage * 6) ? "L" : absolute_vodka > (minimum_wage * 4) ? "M" : "S"
            
        string balloon_size = switch pants_size
            "L" => size.large
            "M" => size.normal
            => size.small
        string aura_size = switch balloon_size
            size.small  => size.normal
            size.normal => size.large
            => size.huge

        float stuff_for_math = potato_battery_source == "Volume Delta" ? plain_water : absolute_vodka
        float mystery_ratio = stuff_for_math != 0 ? absolute_vodka / stuff_for_math : na
        
        string scary_text = is_spongy ? "\n‚ö†Ô∏è ABSORPTION DETECTED ‚ö†Ô∏è\n(High Vol / Low Move)" : ""
        string label_thingy = potato_battery_source == "Volume Delta" ? "Delta Vol: " : "Total Vol: "
        string way_to_go  = stonks_only_go_up ? "Bullish " : "Bearish "
        string sign_language = potato_battery_source == "Volume Delta" ? (stonks_only_go_up ? "+" : "-") : "" 
        
        string secret_scroll = way_to_go + (potato_battery_source == "Volume Delta" ? "Delta" : "Vol") + scary_text + "\n" + label_thingy + sign_language + make_pretty_numbers(raw_fish) + "\n" + "Z-Score: " + str.tostring(alien_math, "#.##") + "œÉ\n" + (potato_battery_source == "Volume Delta" ? "Dom: " + str.tostring(mystery_ratio * 100, format.mintick) + "%" : "")

        if radioactive
            label.new(bar_index, magic_carpet, "", xloc.bar_index, yloc.price, color=nuclear_waste, style=label.style_circle, size=aura_size, tooltip=secret_scroll)
        label.new(bar_index, magic_carpet, "", xloc.bar_index, yloc.price, color=jelly_bean, style=label.style_circle, size=balloon_size, tooltip=secret_scroll)
                  
        string text_decoration = potato_battery_source == "Volume Delta" ? (stonks_only_go_up ? "+" : "-") : ""
        string final_words = text_decoration + make_pretty_numbers(raw_fish)

        label.new(bar_index, magic_carpet, final_words, xloc.bar_index, yloc.price, color=color.new(color.white, 100), style=label.style_label_center, textalign=text.align_center, textcolor=scribbles, size=balloon_size, text_font_family=comic_sans_wannabe == "Monospace" ? font.family_monospace : font.family_default, tooltip=secret_scroll)

// Alerts
if barstate.isconfirmed and bubble_kaboom
    string shout_msg = ""
    bool scream_loudly = false
    string mode_blah = potato_battery_source == "Volume Delta" ? "Delta" : "Volume"
    string val_blah  = make_pretty_numbers(raw_fish)
    string z_blah    = str.tostring(alien_math, "#.##")

    if is_spongy and sponge_alarm
        shout_msg := "‚ö†Ô∏è ABSORPTION DETECTED on " + syminfo.ticker + "\n" + "Mode: " + mode_blah + "\n" + "Value: " + val_blah + "\n" + "Price: " + str.tostring(real_deal_c, format.mintick)
        scream_loudly := true
    else if siren_woop_woop
        shout_msg := "üö® UNUSUAL " + mode_blah + " on " + syminfo.ticker + "\n" + "Value: " + val_blah + "\n" + "Z-Score: " + z_blah + "œÉ"
        scream_loudly := true
    if scream_loudly
        alert(shout_msg, alert.freq_once_per_bar_close)

// === Strategy Entries/Exits ===
if enable_trading
    if long_momentum
        strategy.entry("DeltaSignal", strategy.long, qty=position_size, comment="Bullish Momentum")
    if short_momentum
        strategy.entry("DeltaSignal", strategy.short, qty=position_size, comment="Bearish Momentum")
    
    // Legacy fixed exits
    float stop_dist   = atr_stop_mult * wiggle_room
    float profit_dist = stop_dist * rr_ratio
    float tick_stop   = stop_dist / syminfo.mintick
    float tick_profit = profit_dist / syminfo.mintick
    
    strategy.exit("Exit", from_entry="DeltaSignal", profit=tick_profit, loss=tick_stop)

    //Delta/Volume Bubble Signals [Quant Z-Score] Maxxed Verison

    This indicator combines advanced volume delta analysis with smart filtering to generate high-conviction intraday signals on futures like YM, ES, and NQ (5-minute charts perform particularly well in testing).
    
    Special thanks to L&L Capital for the LNL Trend System, which provides the excellent dynamic chop detection and cloud visuals used here.
    
    A very BIG thanks to tncylyv for the original volume delta bubble script ‚Äî its Z-score normalization on extreme volume/delta is the foundation of the core detection logic.This entire system is now possible thanks to TradingView's addition of Volume Delta data in the Footprint chart, allowing accurate lower-timeframe delta aggregation without external feeds. Core Concept the indicator identifies extreme volume/delta spikes ‚Äî moments when significant buying or selling pressure appears ‚Äî and only signals when multiple confluence filters align. This results in lower-frequency, higher-quality trades that aim to capture institutional momentum while avoiding noise.
    
    How It Works ‚Äî Key Components Volume Delta Detection (The Heart of the System) Uses TradingView's built-in footprint delta (aggregated from lower TF, default 1-second bars).
    Calculates absolute delta and applies a rolling Z-score (default lookback 60 bars) to normalize extremes across different volatility regimes and instruments.
    Bubbles visualize spikes above threshold (default 1.7œÉ).
    BUY/SELL signals require the same threshold plus additional filters.
    
    Absorption Filter (Enabled by Default) Detects high volume/delta with minimal price movement ("effort vs result" failure = trapped traders).
    Purple glow on bubbles + optional alert.
    Signals are suppressed on absorption bars to avoid counter-trend traps.
    
    Trend Filter (Nadaraya-Watson from jdehorty as default) Non-repainting kernel regression line for smooth, adaptive trend following.
    
    Signals only fire when price is on the correct side of the trend line (above for longs, below for shorts). Can be disabled or switched to EMA/WMA/KAMA.
    
    LNL Chop Filter (Tight Mode by Default) Dynamic ATR-based stop zones from L&L's system.
    When stop levels appear on both sides of price = sideways/chop (no-go zone).
    Signals completely suppressed during chop.
    
    
    
    Usage Tips Best on intraday futures (YM 5-min has shown strong results in testing).
    Defaults are tuned for balance: 1.7œÉ threshold, Tight LNL mode, absorption on.
    Strategy version (separate script) adds LNL trailing stops for actual backtesting/exits.
    Customize freely ‚Äî try different LNL modes (Net for wider range), trend types, or Z-thresholds.
    
    Also available the matching indicator by yours truly.
    
    Important: Forward Test Thoroughly This indicator was refined on historical data, so there's always risk of over-fitting.
    Always forward test on live or paper accounts for weeks/months before real capital: Validate across different market regimes (trending, ranging, high/low volatility).
    Compare out-of-sample periods.
    Adjust one parameter at a time and re-validate forward.
    Markets change ‚Äî what worked yesterday may need tweaking tomorrow.
    
    Feel free to use, modify, and share. Good luck, and trade well! ‚Äî Max