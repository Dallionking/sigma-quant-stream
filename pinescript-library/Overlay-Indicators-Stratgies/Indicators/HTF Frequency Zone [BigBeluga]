// This work is licensed under Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International  
// https://creativecommons.org/licenses/by-nc-sa/4.0/
// Â© BigBeluga

//@version=6
indicator("HTF Frequency Zone [BigBeluga]", overlay = true, max_lines_count = 500, calc_bars_count = 3000)

// ï¼©ï¼®ï¼°ï¼µï¼´ï¼³ â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•{

tf    = input.string("W", "Timeframe", ["D", "W", "M"])
colUp = input.color(color.lime, "", inline = "c")
colDn = input.color(color.orange, "", inline = "c")
colPC = input.color(color.red, "", inline = "c")

var H           = 0.
var L           = low
var VZ          = 0.
var barSize     = 0
buy             = 0
sell            = 0
var valueStart  = 0.
var start       = 0
// }

// ï¼£ï¼¡ï¼¬ï¼£ï¼µï¼¬ï¼¡ï¼´ï¼©ï¼¯ï¼®ï¼³â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•{


if timeframe.change(tf)

    col = close > valueStart[1] ? colUp : colDn
    

    if barSize > 10
        lh = line.new(start, H, bar_index, H, style = line.style_dotted, color = col)
        ll = line.new(start, L, bar_index, L, style = line.style_dotted, color = col)
        line.new(start, VZ, bar_index, VZ, style = line.style_dotted, color = col)

        linefill.new(lh, ll, color.new(col, 95))


    H       := 0.
    L       := low
    VZ      := 0
    valueStart := 0
    
    buy  := 0
    sell := 0

    barSize := bar_index - start

    barSize := barSize >= 500 ? 500 : barSize

    start   := bar_index
    valueStart := close

// ï¼°ï¼¬ï¼¯ï¼´ â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•{

if barSize > 10

    value = 0

    for i = 0 to bar_index - start

        H    := math.max(H, high[i])
        L    := math.min(L, low[i])
        buy  += close[i] > open[i] ? 1 : 0
        sell += close[i] < open[i] ? 1 : 0

    line.delete(line.new(start, H, start+barSize, H, style = line.style_dashed, color = colDn)[1])
    line.delete(line.new(start, L, start+barSize, L, style = line.style_dashed, color = colUp)[1])

    step = (H - L) / 100

    bins = array.new<int>(100, 0)

    for i = 0 to bar_index - start

        cls = close[i]

        for k = 0 to 100-1

            loww = L + step * k
            mid  = loww + step/2

            if math.abs(cls - mid) < step 
                bins.set(k, bins.get(k) + 1)

    poc  = L + step * bins.indexof(bins.max())
    VZ  := poc
    line.delete(line.new(start, poc, start+barSize, poc, style = line.style_solid, color = colPC, width = 2)[1])

    txtTF = switch tf 
        "D" => "Daily: "
        "W" => "Weekly: "
        "M" => "Monthly: "
        
    label.delete(label.new(start+barSize, VZ, txtTF + str.tostring(bins.max()), style = label.style_label_left, color = colPC)[1])
    label.delete(label.new(start+barSize, H, str.tostring(sell), style = label.style_label_left, color = color.new(colDn, 50))[1])
    label.delete(label.new(start+barSize, L, str.tostring(buy ), style = label.style_label_left, color = color.new(colUp, 50))[1])
else if barstate.islast
    label.delete(label.new(bar_index, hl2, "Change Chart timeframe to lower\nor indicator's timeframe to higher âš ï¸", style = label.style_label_left, color = color.orange)[1])



// }


//OVERVIEW
HTF Frequency Zone [BigBeluga] highlights the dominant price level (Point of Control) and the full highâ€“low expansion of any higher timeframe â€” Daily, Weekly, or Monthly. It captures the frequency of closes inside each HTF candle and plots the most traded â€œfrequency zoneâ€, allowing traders to easily see where price spent the most time and where buy/sell pressure accumulated.

This tool transforms each higher-timeframe bar into a fully visualized structure:
â€¢ Top = HTF high
â€¢ Bottom = HTF low
â€¢ Midline = HTF Frequency POC
â€¢ Color-coded zones = bullish or bearish bias
â€¢ Labels = counts of bullish and bearish candles inside the HTF range

It is designed to give traders an immediate understanding of high-timeframe balance, imbalance, and price attraction zones.

ðŸ”µ CONCEPTS
HTF Partitioning â€” Each Weekly/Daily/Monthly candle is converted into a dedicated zone with its own High, Low, and Frequency Point of Control.
snapshot
Frequency POC (Most Touched Price) â€” The indicator divides the HTF range into 100 bins and counts how many times price closed near each level.
snapshot
Dominant Zone â€” The level with the highest frequency becomes the HTF â€œValue Zone,â€ plotted as a bold central line.

Directional Bias â€”
â€¢ Bullish HTF zone
snapshot

â€¢ Bearish HTF zone
snapshot
Internal Candle Counting â€” Within each HTF period the indicator counts:
â€¢ Buy candles (close > open)
â€¢ Sell candles (close < open)
snapshot

This reveals whether intraperiod flow was bullish or bearish.
HTF Structure Blocks â€” High, Low, and POC are connected across the entire higher-timeframe duration, showing the real shape of HTF balance.
snapshot


ðŸ”µ FEATURES
Automatic HTF Zone Construction â€” Generates a complete price zone every time the selected timeframe flips (Daily / Weekly / Monthly).
Dynamic High & Low Extraction â€” The indicator scans every bar inside the HTF window to find true extremes of the range.
100-Level Frequency Scan â€” Each close within the period is assigned to a bin, creating a detailed distribution of price interaction.
HTF POC Highlighting â€” The most frequent price level is plotted with a bold red line for immediate visual clarity.
Bull/Bear Coloring â€”
â€¢ Green â†’ Bullish HTF zone.
â€¢ Orange â†’ Bearish HTF zone.
Zone Shading â€” Highâ€“Low range is filled with a semi-transparent color matching trend direction.
Buy/Sell Candle Counters â€” Printed at the top and bottom of each HTF block, showing how many internal candles were bullish or bearish.
POC Label â€” Displays frequency count (how many touches) at the POC level.
Adaptive Threshold Warning â€” If bars inside the HTF window are too few (<10), the indicator warns the trader to switch timeframe.


ðŸ”µ HOW TO USE
Higher-Timeframe Biasing â€” Read the zone color to determine if the HTF candle leaned bullish or bearish.
Value Zone Reactions â€” Price often reacts to the Frequency POC; use it as support/resistance or liquidity magnet.
snapshot
snapshot
Range Context â€” Identify when price is trading near HTF highs (breakout potential) or lows (reversal potential).
Momentum Evaluation â€” More bullish internal candles = internal buying pressure; more bearish = internal selling pressure.
Swing Trading â€” Use HTF zones as the â€œmacro map,â€ then execute trades on lower timeframes aligned with the zone structure.
Liquidity Awareness â€” The HTF POC often aligns with algorithmic liquidity levels, making it a strong reaction point.


ðŸ”µ CONCLUSION
HTF Frequency Zone [BigBeluga] transforms raw higher-timeframe candles into detailed distribution zones that reveal true market behavior inside the HTF structure. By showing highs, lows, buying/selling activity, and the most interacted price level (Frequency POC), this tool becomes invaluable for traders who want to align executions with powerful HTF levels, liquidity magnets, and structural zones.